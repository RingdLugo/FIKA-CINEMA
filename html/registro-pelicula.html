<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro de Pel√≠culas - FIKA CINEMA</title>
  <link rel="stylesheet" href="../css/registro-pelicula.css">


  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

</head>
<body>

  <nav class="navbar border-bottom nav-fondo nav-sombra">
    <div class="container-fluid d-flex align-items-center justify-content-start gap-3">

      <a href="../html/admin-panel.html" class="btn btn-outline-secondary btn-lg">
        <i class="bi bi-arrow-left fs-4"></i>
      </a>

      <img src="../img/fikacinema.png" alt="Logo Fika Cinema" class="logo">

    </div>
  </nav>

<div class="app-container">

  <!-- ---- Header / Logo ---- -->


  <!-- ---- Panel principal ---- -->
  <div class="main-panel">

    <!-- ---- Formulario de pel√≠cula ---- -->
    <div class="form-panel">
      <div class="section-title">Datos de la pel√≠cula</div>

      <form id="peliculaForm" class="form-fields" onsubmit="return false;">
        <div class="row">
          <label for="noPelicula">No. Pel√≠cula</label>
          <input type="text" id="noPelicula" name="noPelicula" class="input-box short" placeholder="Ej: 1 (prueba 1-100)">
        </div>
        <div class="row">
          <label for="generos">G√©neros</label>
          <input type="text" id="generos" name="generos" class="input-box long" placeholder="Acci√≥n, Drama, Suspenso...">
        </div>
        <div class="row">
          <label for="serie">Serie</label>
          <input type="text" id="serie" name="serie" class="input-box long" placeholder="Ej: Marvel Cinematic Universe">
        </div>
        <div class="row">
          <label for="duracion">Duraci√≥n</label>
          <input type="text" id="duracion" name="duracion" class="input-box short" placeholder="Ej: 128 min">
        </div>
        <div class="row sinopsis-row">
          <label for="sinopsis">Sinopsis</label>
          <textarea id="sinopsis" name="sinopsis" class="input-box sinopsis" placeholder="Breve descripci√≥n de la pel√≠cula..."></textarea>
        </div>
        <div class="row">
          <label for="estado">Estado</label>
          <select id="estado" name="estado" class="input-box short">
            <option value="">Seleccionar</option>
            <option value="estreno">Estreno</option>
            <option value="preventa">Preventa</option>
            <option value="preestreno">Pre-estreno</option>
            <option value="cartelera">En cartelera</option>
            <option value="proximamente">Pr√≥ximamente</option>
          </select>
        </div>
        <div class="row">
          <label for="idioma">Idioma</label>
          <select id="idioma" name="idioma" class="input-box medium">
            <option value="">Seleccionar</option>
            <option value="espa√±ol">Espa√±ol</option>
            <option value="espanol-sub">Espa√±ol (subtitulada)</option>
            <option value="ingles">Ingl√©s (subtitulada)</option>
            <option value="ingles-doblada">Ingl√©s (doblada)</option>
            <option value="otro">Otro</option>
          </select>
        </div>
        <div class="row">
          <label for="reparto1">Reparto 1</label>
          <input type="text" id="reparto1" name="reparto1" class="input-box long" placeholder="Actor principal o director">
        </div>
        <div class="row">
          <label for="reparto2">Reparto 2</label>
          <input type="text" id="reparto2" name="reparto2" class="input-box long" placeholder="Actor secundario o productor">
        </div>
        <div class="row">
          <label for="posterUpload">P√≥ster</label>
          <input type="file" id="posterUpload" name="poster" accept="image/*" class="input-box long">
        </div>
      </form>
    </div>

    <!-- ---- Panel de previsualizaci√≥n ---- -->
    <div class="poster-panel">
      <div class="section-title poster-title">‚Äî POSTER ‚Äî</div>
      <div class="poster-box">
        <img src="https://images.unsplash.com/photo-1607604053594-86421d8b4761?w=400"
             alt="Previsualizaci√≥n del p√≥ster" id="posterPreview">
      </div>
    </div>

  </div>

  <!-- ---- Toolbar / botones ---- -->
  <div class="toolbar">
    <div class="toolbar-label">Mantenimiento</div>
    <div class="buttons-group">
      <button type="button" class="btnform insert">üì• Insertar</button>
      <button type="button" class="btnform buscar">üîç Buscar</button>
      <button type="button" class="btnform modificar">üñäÔ∏è Modificar</button>
      <button type="button" class="btnform eliminar">üóëÔ∏è Eliminar</button>
      <a href="index.html" class="btnform volver">‚Ü©Ô∏è Volver</a>
    </div>
  </div>

</div>

<!-- ---- Scripts ---- -->
<script>
  // Previsualizaci√≥n de la imagen del p√≥ster
  document.getElementById('posterUpload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('posterPreview');
    if (file) {
      const reader = new FileReader();
      reader.onload = function(event) { preview.src = event.target.result; };
      reader.readAsDataURL(file);
    } else {
      preview.src = "https://images.unsplash.com/photo-1607604053594-86421d8b4761?w=400";
    }
  });

  // URL simulada de API
  const BASE_URL = 'https://jsonplaceholder.typicode.com/posts';
  const form = document.getElementById('peliculaForm');

  function getFormData() {
    const data = {};
    new FormData(form).forEach((value, key) => {
      if (typeof value === 'string') {
        const trimmed = value.trim();
        if (trimmed !== '') data[key] = trimmed;
      }
    });
    return data;
  }

  function showMessage(title, message, isError = false) {
    alert(title + "\n\n" + message + (isError ? "\n\n(Revisa consola F12 si hay problemas)" : ""));
  }

  // ---- INSERTAR ----
  document.querySelector('.btnform.insert').addEventListener('click', async function(e) {
    e.preventDefault();
    const data = getFormData();
    if (!data.noPelicula || !data.generos || !data.sinopsis) {
      showMessage('Campos obligatorios', 'Completa No. Pel√≠cula, G√©neros y Sinopsis', true);
      return;
    }
    try {
      const response = await fetch(BASE_URL, {
        method: 'POST',
        body: JSON.stringify({ ...data, userId: 1 }),
        headers: { 'Content-type': 'application/json; charset=UTF-8' }
      });
      const result = await response.json();
      showMessage('√âxito (simulado)', `Pel√≠cula insertada con ID: ${result.id}`);
      form.reset();
      document.getElementById('posterPreview').src = "https://images.unsplash.com/photo-1607604053594-86421d8b4761?w=400";
    } catch (error) {
      console.error(error);
      showMessage('Error al insertar', error.message || 'Revisa la consola', true);
    }
  });

  // ---- BUSCAR ----
  document.querySelector('.btnform.buscar').addEventListener('click', async function(e) {
    e.preventDefault();
    let id = document.getElementById('noPelicula').value.trim();
    id = id ? parseInt(id, 10).toString() : '';
    if (!id || isNaN(id) || id <= 0) { showMessage('Valor inv√°lido', 'Ingresa un n√∫mero v√°lido', true); return; }
    try {
      const response = await fetch(`${BASE_URL}/${id}`);
      const data = await response.json();
      showMessage('Encontrado', `ID: ${data.id}\nT√≠tulo: ${data.title.substring(0, 60)}...`);
    } catch (error) {
      console.error(error);
      showMessage('No encontrado', `No existe registro con ID ${id}`, true);
    }
  });

  // ---- MODIFICAR ----
  document.querySelector('.btnform.modificar').addEventListener('click', async function(e) {
    e.preventDefault();
    let id = document.getElementById('noPelicula').value.trim();
    id = id ? parseInt(id, 10).toString() : '';
    const data = getFormData();
    if (!id || isNaN(id)) { showMessage('Requerido', 'Ingresa un ID v√°lido', true); return; }
    if (!data.generos || !data.sinopsis) { showMessage('Faltan campos', 'Completa G√©neros y Sinopsis', true); return; }
    try {
      const response = await fetch(`${BASE_URL}/${id}`, {
        method: 'PUT',
        body: JSON.stringify({ id: Number(id), ...data, userId: 1 }),
        headers: { 'Content-type': 'application/json; charset=UTF-8' }
      });
      const result = await response.json();
      showMessage('√âxito', `Modificado ID ${result.id}`);
    } catch (error) {
      console.error(error);
      showMessage('Error al modificar', error.message || 'Revisa consola', true);
    }
  });

  // ---- ELIMINAR ----
  document.querySelector('.btnform.eliminar').addEventListener('click', async function(e) {
    e.preventDefault();
    let id = document.getElementById('noPelicula').value.trim();
    id = id ? parseInt(id, 10).toString() : '';
    if (!id || isNaN(id)) { showMessage('Requerido', 'Ingresa un ID v√°lido', true); return; }
    if (!confirm(`¬øEliminar pel√≠cula ID ${id}?`)) return;
    try {
      const response = await fetch(`${BASE_URL}/${id}`, { method: 'DELETE' });
      if (response.ok) {
        showMessage('√âxito', `Eliminado ID ${id}`);
        form.reset();
        document.getElementById('posterPreview').src = "https://images.unsplash.com/photo-1607604053594-86421d8b4761?w=400";
      } else throw new Error(`HTTP ${response.status}`);
    } catch (error) {
      console.error(error);
      showMessage('Error al eliminar', error.message || 'Revisa consola', true);
    }
  });
</script>

</body>
</html>